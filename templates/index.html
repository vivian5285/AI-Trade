<!-- 在仪表盘卡片后添加 -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">交易机器人控制</h5>
    </div>
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <div class="status-indicator" id="botStatusIndicator"></div>
                    </div>
                    <div>
                        <h6 class="mb-0">交易机器人状态</h6>
                        <p class="text-muted mb-0" id="botStatusText">正在检查...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-success me-2" id="startBot" disabled>
                    <i class="fas fa-play"></i> 启动
                </button>
                <button class="btn btn-danger me-2" id="stopBot" disabled>
                    <i class="fas fa-stop"></i> 停止
                </button>
                <button class="btn btn-warning" id="restartBot" disabled>
                    <i class="fas fa-sync"></i> 重启
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 在页面底部的JavaScript部分添加 -->
<script>
// 交易机器人控制
function updateBotStatus() {
    fetch('/api/trading-bot/status')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const isRunning = data.is_running;
                const statusIndicator = document.getElementById('botStatusIndicator');
                const statusText = document.getElementById('botStatusText');
                const startBtn = document.getElementById('startBot');
                const stopBtn = document.getElementById('stopBot');
                const restartBtn = document.getElementById('restartBot');
                
                if (isRunning) {
                    statusIndicator.className = 'status-indicator active';
                    statusText.textContent = '运行中';
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                    restartBtn.disabled = false;
                } else {
                    statusIndicator.className = 'status-indicator';
                    statusText.textContent = '已停止';
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    restartBtn.disabled = true;
                }
            }
        })
        .catch(error => {
            console.error('获取交易机器人状态失败:', error);
        });
}

// 启动交易机器人
document.getElementById('startBot').addEventListener('click', function() {
    fetch('/api/trading-bot/start', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('success', data.message);
            setTimeout(updateBotStatus, 1000);
        } else {
            showNotification('error', data.error);
        }
    })
    .catch(error => {
        showNotification('error', '启动交易机器人失败');
    });
});

// 停止交易机器人
document.getElementById('stopBot').addEventListener('click', function() {
    fetch('/api/trading-bot/stop', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('success', data.message);
            setTimeout(updateBotStatus, 1000);
        } else {
            showNotification('error', data.error);
        }
    })
    .catch(error => {
        showNotification('error', '停止交易机器人失败');
    });
});

// 重启交易机器人
document.getElementById('restartBot').addEventListener('click', function() {
    fetch('/api/trading-bot/restart', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('success', data.message);
            setTimeout(updateBotStatus, 1000);
        } else {
            showNotification('error', data.error);
        }
    })
    .catch(error => {
        showNotification('error', '重启交易机器人失败');
    });
});

// 定期更新状态
setInterval(updateBotStatus, 5000);
updateBotStatus();
</script>

<style>
.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: #dc3545;
    display: inline-block;
}

.status-indicator.active {
    background-color: #28a745;
}
</style> 